# 时序图
[[0. 时序图#1. 素材管理]]

# 技术栈
## 1. 雪花算法生成id
[[雪花算法(SnowFlake)]]
## 2. Json
使用`Gson`开源库，[项目地址](https://github.com/google/gson)。

## 3. OSS

## 4. MQTT

## 5. AIDL
[[AIDL]]

# 问题汇总
### Q1. 导播界面添加素材时，如果从设备端添加，数据来源是什么？
答：来源是设备端的预置素材+该设备包含的云素材。[[素材库Q1.png]]
### Q2. 阿里云的topic, 我没办法定义出不带user这个字段的
答：就是一定要带user，我看接口文档上已经改了
### Q3. 删除素材时能不能用filePath代替sourceId(因为设备端没有sourceId的数据库)?
答：设备端建立数据库了。
### Q4. 【设备】设备删除Web下发素材 这个API的消息对象能不能变成List\<SourceId\>?

# 测试Json
### delete request(单个)
```json
{
	"id": "1654727151497121792",
	"topic": "/iiyvHvXkF0N/cpl-device-4/user/material/send",
	"deviceName": "cpl-device-4",
	"data": {
		"sourceId": "aabb"
	}
}
```

### delete request(多个)
```json
{
	"id": "1654727151497121792",
	"topic": "/iiyvHvXkF0N/cpl-device-4/user/material/send",
	"deviceName": "cpl-device-4",
	"data": {
		"sourceIdList": [
			"aabb",
			"006f9a94ce8c4c9c8cc57b36c6b2c59a"
		]
	}
}
```

### delete response
```json
{  
    "data":{  
        "code":0,  
        "message":"OK"  
    },  
    "deviceName":"cpl-device",  
    "id":"1654727151497121792",  
    "topic":"/ie42YsvOd8P/NewDevice/user/status"  
}
```

### add request
```json
{
	"id": "1654727151497121792",
	"topic": "/iiyvHvXkF0N/cpl-device-4/user/material/send",
	"deviceName": "cpl-device-4",
	"data": {
		"sourceList": [
			{
				"sourceId": "006f9a94ce8c4c9c8cc57b36c6b2c59a",
				"ossUrl": "https://cpl-share.oss-cn-hangzhou.aliyuncs.com/source/%E6%8E%A8%E6%B5%81/%E8%AE%BE%E5%A4%87%E6%8E%A7%E5%88%B6-%E6%8E%A8%E6%B5%81%E5%A4%B1%E8%B4%A5.png/%E8%AE%BE%E5%A4%87%E6%8E%A7%E5%88%B6-%E6%8E%A8%E6%B5%81%E5%A4%B1%E8%B4%A5.png?Expires=1683352970&OSSAccessKeyId=LTAI5tLBVhMDM1XFvxLP4kTk&Signature=bLXF6FC3eHJmjtjoAZxwLtLZS%2FE%3D",
				"md5": "262854ed30e87bddc66458c3f4daac9a",
				"path": "test/设备控制-推流失败.png/设备控制-推流失败.png",
				"group": 0,
				"type": "0"
			}
		]
	}
}
```